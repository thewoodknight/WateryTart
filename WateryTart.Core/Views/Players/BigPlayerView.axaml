<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:vm="clr-namespace:WateryTart.Core.ViewModels"
			 xmlns:app="clr-namespace:WateryTart.Core"
			 xmlns:asyncImageLoader="using:AsyncImageLoader"
			 xmlns:converters="using:WateryTart.Core.Converters"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:materialIcons="using:Material.Icons.Avalonia"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:controls="clr-namespace:WateryTart.Core.Controls"
			 xmlns:players="clr-namespace:WateryTart.Core.ViewModels.Players"
			 mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 x:Class="WateryTart.Core.Views.Players.BigPlayerView"
			 x:DataType="players:BigPlayerViewModel">
	<UserControl.Resources>
		<converters:FriendlyTimeConverter x:Key="FriendlyTimeConverter" />
		<converters:MetadataImageConverter x:Key="MetadataImageConverter" />
		<x:Double x:Key="ControlContentThemeFontSize">16</x:Double>
		<converters:ToUpperValueConverter x:Key="ToUpperValueConverter" />
		<converters:PlaybackStateToVisibilityConverter x:Key="PlaybackStateToVisibilityConverter" />
		<converters:AudioFormatCodecConverter x:Key="AudioFormatCodecConverter" />
		<converters:AudioFormatSampleRateConverter x:Key="AudioFormatSampleRateConverter" />
		<converters:AudioFormatBitDepthConverter x:Key="AudioFormatBitDepthConverter" />
	</UserControl.Resources>

	<Grid>
		<!-- Normal Display Mode -->
		<controls:ResponsiveColumnPanel Breakpoint="600" IsVisible="{Binding !IsSmallDisplay}">
			<controls:ResponsiveColumnPanel.FirstColumn>
				<StackPanel Margin="10" Spacing="10">
					<Border Margin="20,0,20,0"
							BoxShadow="0 0 20 0 Black"
							MaxHeight="300"
							MaxWidth="300">
						<Border ClipToBounds="True" CornerRadius="5">
							<asyncImageLoader:AdvancedImage
							Name="imgAlbumArt"
							Loader="{x:Static app:App.ImageLoaderInstance}"
							Source="{Binding Path=PlayersService.SelectedQueue.current_item.image, Converter={StaticResource MassImageImageConverter}}" />
						</Border>
					</Border>

					<Grid Margin="20" MaxWidth="400">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.elapsed_time, Converter={StaticResource FriendlyTimeConverter}}" />
						<ProgressBar Grid.Column="1" Margin="10,0,10,0" Foreground="Red" Height="15" Value="{Binding PlayersService.Progress}" Minimum="0" Maximum="100" />
						<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.duration, Converter={StaticResource FriendlyTimeConverter}}" />
					</Grid>

					<StackPanel Margin="15,5,5,5">
						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.artists[0].Name}" FontSize="18"/>
						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.Name}" FontSize="20" FontWeight="Bold" />
						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.album.Name}" />
						
						<!-- Quality Badges - Each as separate tag -->
						<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="6" Margin="0,10,0,0">
							<!-- Codec Badge (FLAC, MP3, OPUS, etc.) -->
							<Border Background="#1A1A1A" 
									BorderBrush="#1DB954"
									BorderThickness="1"
									CornerRadius="4" 
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatCodecConverter}}" 
										   FontSize="11" 
										   FontWeight="Bold"
										   Foreground="#1DB954" />
							</Border>
							
							<!-- Sample Rate Badge (44.1kHz, 48kHz, etc.) -->
							<Border Background="#1A1A1A" 
									BorderBrush="#64B5F6"
									BorderThickness="1"
									CornerRadius="4" 
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatSampleRateConverter}}" 
										   FontSize="11" 
										   FontWeight="Bold"
										   Foreground="#64B5F6" />
							</Border>
							
							<!-- Bit Depth Badge (16bit, 24bit, etc.) -->
							<Border Background="#1A1A1A" 
									BorderBrush="#FFB74D"
									BorderThickness="1"
									CornerRadius="4" 
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatBitDepthConverter}}" 
										   FontSize="11" 
										   FontWeight="Bold"
										   Foreground="#FFB74D" />
							</Border>
						</StackPanel>
					</StackPanel>

					<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
						<Button Classes="iconButton navButton" Command="{Binding PlayerPreviousCommand}" Margin="3,0,3,0"><materialIcons:MaterialIcon Kind="SkipPrevious" Width="25" Height="25" /></Button>
						<Button Classes="iconButton navButton" Command="{Binding PlayerPlayPauseCommand}" Margin="3,0,3,0"><materialIcons:MaterialIcon Kind="PlayPause" Width="25" Height="25" /></Button>
						<Button Classes="iconButton navButton" Command="{Binding PlayNextCommand}" Margin="3,0,20,0"><materialIcons:MaterialIcon Kind="SkipNext" Width="25" Height="25" /></Button>
					</StackPanel>

					<Grid MaxWidth="400">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" Text="0" />
						<ProgressBar Grid.Column="1" Margin="10,0,10,0" Foreground="Red" Height="5" Value="{Binding PlayersService.SelectedPlayer.VolumeLevel}" Minimum="0" Maximum="100" />
						<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedPlayer.VolumeLevel}" />
					</Grid>
				</StackPanel>
			</controls:ResponsiveColumnPanel.FirstColumn>

			<controls:ResponsiveColumnPanel.SecondColumn>
				<TabControl>
					<TabItem Header="Queue">
						<ListBox ItemsSource="{Binding PlayersService.CurrentQueue}" Background="{x:Null}">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<TextBlock>
										<Run Text="{Binding sort_index}" />
										<Run Text=". " />
										<Run Text="{Binding name}" />
									</TextBlock>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</TabItem>
					<TabItem Header="Played">
						<ListBox ItemsSource="{Binding PlayersService.PlayedQueue}" Background="{x:Null}">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<TextBlock>
										<Run Text="{Binding sort_index}" />
										<Run Text=". " />
										<Run Text="{Binding name}" />
									</TextBlock>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</TabItem>
				</TabControl>
			</controls:ResponsiveColumnPanel.SecondColumn>
		</controls:ResponsiveColumnPanel>

		<!-- Small Display Mode -->
		<Grid IsVisible="{Binding IsSmallDisplay}">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>

			<Border Grid.Column="0" Margin="10" HorizontalAlignment="Center" VerticalAlignment="Top"
					BoxShadow="0 0 10 0 Black"
					MaxHeight="300"
					MaxWidth="300">
				<Border ClipToBounds="True" CornerRadius="5">
					<asyncImageLoader:AdvancedImage
					    Loader="{x:Static app:App.ImageLoaderInstance}"
					    Stretch="Uniform"
                        MaxHeight="300"
                        MaxWidth="300"
					    Source="{Binding Path=PlayersService.SelectedQueue.current_item.image, Converter={StaticResource MassImageImageConverter}}" />
				</Border>
			</Border>

			<!-- Track Info -->
			<StackPanel Grid.Column="1" Margin="10" Spacing="5"  VerticalAlignment="Top">
				<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.Name}"  FontWeight="Bold" TextTrimming="CharacterEllipsis" />
				<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.artists[0].Name}" TextTrimming="CharacterEllipsis"/>

				<!-- Quality Badges for Small Display - Each as separate tag -->
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4" Margin="0,5,0,0">
					<!-- Codec Badge -->
					<Border Background="#1A1A1A" 
							BorderBrush="#1DB954"
							BorderThickness="1"
							CornerRadius="3" 
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatCodecConverter}}" 
								   FontSize="9" 
								   FontWeight="Bold"
								   Foreground="#1DB954" />
					</Border>
					
					<!-- Sample Rate Badge -->
					<Border Background="#1A1A1A" 
							BorderBrush="#64B5F6"
							BorderThickness="1"
							CornerRadius="3" 
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatSampleRateConverter}}" 
								   FontSize="9" 
								   FontWeight="Bold"
								   Foreground="#64B5F6" />
					</Border>
					
					<!-- Bit Depth Badge -->
					<Border Background="#1A1A1A" 
							BorderBrush="#FFB74D"
							BorderThickness="1"
							CornerRadius="3" 
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.current_item.streamdetails.audio_format, Converter={StaticResource AudioFormatBitDepthConverter}}" 
								   FontSize="9" 
								   FontWeight="Bold"
								   Foreground="#FFB74D" />
					</Border>
				</StackPanel>

				<!-- Compact Progress Bar -->
				<Grid Margin="5,10,5,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Column="0" Text="{Binding PlayersService.SelectedPlayer.CurrentMedia.elapsed_time, Converter={StaticResource FriendlyTimeConverter}}" />
					<ProgressBar Grid.Column="1" Margin="5,0" Foreground="Red" Height="10" Value="{Binding PlayersService.Progress}" Minimum="0" Maximum="100" />
					<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedQueue.current_item.media_item.duration, Converter={StaticResource FriendlyTimeConverter}}"  />
				</Grid>


				<!-- Compact Controls -->
				<StackPanel Grid.Row="2" Margin="10" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
					<Button Classes="iconButton navButton" Command="{Binding PlayerPreviousCommand}"><materialIcons:MaterialIcon Kind="SkipPrevious" Width="30" Height="30" /></Button>
					<Button Classes="iconButton navButton" Command="{Binding PlayerPlayPauseCommand}"><materialIcons:MaterialIcon Kind="PlayPause" Width="30" Height="30" /></Button>
					<Button Classes="iconButton navButton" Command="{Binding PlayNextCommand}"><materialIcons:MaterialIcon Kind="SkipNext" Width="30" Height="30" /></Button>
				</StackPanel>


				<Grid MaxWidth="400" Margin="0,20,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Column="0" Text="0" />
					<ProgressBar Grid.Column="1" Margin="10,0,10,0" Foreground="Red" Height="5" Value="{Binding PlayersService.SelectedPlayer.VolumeLevel}" Minimum="0" Maximum="100" />
					<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedPlayer.VolumeLevel}" />
				</Grid>
			</StackPanel>
		</Grid>
	</Grid>
</UserControl>