<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:vm="clr-namespace:WateryTart.Core.ViewModels"
			 xmlns:app="clr-namespace:WateryTart.Core"
			 xmlns:asyncImageLoader="using:AsyncImageLoader"
			 xmlns:converters="using:WateryTart.Core.Converters"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:materialIcons="using:Material.Icons.Avalonia"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:controls="clr-namespace:WateryTart.Core.Controls"
			 xmlns:players="clr-namespace:WateryTart.Core.ViewModels.Players"
			 mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 x:Class="WateryTart.Core.Views.Players.BigPlayerView"
			 x:DataType="players:BigPlayerViewModel"
			 Margin="0,20,0,0">
	<UserControl.Resources>
		<converters:FriendlyTimeConverter x:Key="FriendlyTimeConverter" />
		<converters:MetadataImageConverter x:Key="MetadataImageConverter" />
		<converters:PlaybackStateToIconConverter x:Key="PlaybackStateToIconConverter" />
		<x:Double x:Key="ControlContentThemeFontSize">16</x:Double>
		<converters:ToUpperValueConverter x:Key="ToUpperValueConverter" />
		<converters:PlaybackStateToVisibilityConverter x:Key="PlaybackStateToVisibilityConverter" />
		<converters:AudioFormatCodecConverter x:Key="AudioFormatCodecConverter" />
		<converters:AudioFormatSampleRateConverter x:Key="AudioFormatSampleRateConverter" />
		<converters:AudioFormatBitDepthConverter x:Key="AudioFormatBitDepthConverter" />
	</UserControl.Resources>

	<Grid>
		<!-- Normal Display Mode -->
		<controls:ResponsiveColumnPanel Breakpoint="600" IsVisible="{Binding !IsSmallDisplay}">
			<controls:ResponsiveColumnPanel.FirstColumn>
				<StackPanel Margin="10" Spacing="10">
					<Border Margin="20,0,20,0"
							BoxShadow="0 0 20 0 Black"
							MaxHeight="300"
							MaxWidth="300">
						<Border ClipToBounds="True" CornerRadius="5">
							<Panel>
								<!-- Placeholder rectangle uses cached dimensions -->
								<Rectangle Fill="#1A1A1A"
										   Width="{Binding CachedImageWidth}"
										   Height="{Binding CachedImageHeight}" />

								<!-- Album art image -->
								<asyncImageLoader:AdvancedImage
								Name="imgAlbumArt"
								Loader="{x:Static app:App.ImageLoaderInstance}"
								Source="{Binding Path=PlayersService.SelectedQueue.CurrentItem.Image, Converter={StaticResource MassImageImageConverter}}" />

								<!-- Loading indicator -->
								<StackPanel HorizontalAlignment="Center"
											VerticalAlignment="Center"
											IsVisible="{Binding Path=#imgAlbumArt.IsLoading}">
									<materialIcons:MaterialIcon Kind="MusicNote"
																Width="60"
																Height="60"
																Foreground="#CCCCCC"
																Classes="spinner"
																RenderTransformOrigin="50%,50%">
										<materialIcons:MaterialIcon.RenderTransform>
											<RotateTransform/>
										</materialIcons:MaterialIcon.RenderTransform>
									</materialIcons:MaterialIcon>
								</StackPanel>
							</Panel>
						</Border>
					</Border>

					<Grid Margin="20" MaxWidth="400">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.ElapsedTime, Converter={StaticResource FriendlyTimeConverter}}" />
						<ProgressBar Grid.Column="1" Margin="10,0,10,0"  Foreground="{Binding ColourService.ColourAccent}" Height="15" Value="{Binding PlayersService.Progress}" Minimum="0" Maximum="100" />
						<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Duration, Converter={StaticResource FriendlyTimeConverter}}" />
					</Grid>

					<StackPanel Margin="0,5,0,5">
                        <Interaction.Behaviors>
                            <EventTriggerBehavior EventName="Tapped">
                                <vm:ClickAction  Command="{Binding PlayingAltMenuCommand }" />
                            </EventTriggerBehavior>
                        </Interaction.Behaviors>

						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Artists[0].Name}" FontSize="18"/>
						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Name}" FontSize="20" FontWeight="Bold" />
						<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Album.Name}" />

						<!-- Quality Badges - Each as separate tag -->
						<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="6" Margin="0,10,0,0">
							<!-- Codec Badge (FLAC, MP3, OPUS, etc.) -->
							<Border Background="#1A1A1A"
									BorderBrush="#1DB954"
									BorderThickness="1"
									CornerRadius="4"
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatCodecConverter}}"
										   FontSize="11"
										   FontWeight="Bold"
										   Foreground="#1DB954" />
							</Border>

							<!-- Sample Rate Badge (44.1kHz, 48kHz, etc.) -->
							<Border Background="#1A1A1A"
									BorderBrush="#64B5F6"
									BorderThickness="1"
									CornerRadius="4"
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatSampleRateConverter}}"
										   FontSize="11"
										   FontWeight="Bold"
										   Foreground="#64B5F6" />
							</Border>

							<!-- Bit Depth Badge (16bit, 24bit, etc.) -->
							<Border Background="#1A1A1A"
									BorderBrush="#FFB74D"
									BorderThickness="1"
									CornerRadius="4"
									Padding="8,3"
									IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
								<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatBitDepthConverter}}"
										   FontSize="11"
										   FontWeight="Bold"
										   Foreground="#FFB74D" />
							</Border>
						</StackPanel>
					</StackPanel>

					<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
						<Button Classes="iconButton navButton" Command="{Binding PlayPreviousCommand}" Margin="3,0,3,0"><materialIcons:MaterialIcon Kind="SkipPrevious" Width="25" Height="25" /></Button>
						<Button Classes="iconButton navButton" Command="{Binding PlayerPlayPauseCommand}" Margin="3,0,3,0">
							<materialIcons:MaterialIcon Kind="{Binding PlayersService.SelectedPlayer.PlaybackState, Converter={StaticResource PlaybackStateToIconConverter}}" Width="25" Height="25" />
						</Button>
						<Button Classes="iconButton navButton" Command="{Binding PlayerNextCommand}" Margin="3,0,20,0"><materialIcons:MaterialIcon Kind="SkipNext" Width="25" Height="25" /></Button>
					</StackPanel>

					<Grid MaxWidth="400">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" Text="0" />
						<ProgressBar Grid.Column="1" Margin="10,0,10,0"  Foreground="{Binding ColourService.ColourAccent}" Height="5" Value="{Binding PlayersService.SelectedPlayer.VolumeLevel}" Minimum="0" Maximum="100" />
						<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedPlayer.VolumeLevel}" />
					</Grid>
				</StackPanel>
			</controls:ResponsiveColumnPanel.FirstColumn>

			<controls:ResponsiveColumnPanel.SecondColumn>
				<TabControl >
					<TabControl.Styles>
						<Style Selector="TabControl">
							<Setter Property="ItemsPanel">
								<ItemsPanelTemplate>
									<UniformGrid Columns="{Binding $parent[TabControl].Items.Count}"/>
								</ItemsPanelTemplate>
							</Setter>
						</Style>
						<Style Selector="TabItem">
							<Setter Property="HeaderTemplate">
								<DataTemplate>
									<TextBlock
									FontWeight="Bold"
									FontSize="16"
									Text="{Binding Converter={StaticResource ToUpperValueConverter}}"
									TextAlignment="Center"/>
								</DataTemplate>
							</Setter>
						</Style>

						<Style Selector="TabItem">
							<Setter Property="Padding" Value="0"/>
						</Style>

						<Style Selector="TabItem:selected /template/ Border#PART_SelectedPipe">
							<Setter Property="Background" Value="White"/>
						</Style>

						<Style Selector="TabItem:not(:selected) /template/ Border#PART_SelectedPipe">
							<Setter Property="Background" Value="#70FFFFFF"/>
							<Setter Property="IsVisible" Value="True"/>
						</Style>
					</TabControl.Styles>
					<!--<TabItem Header="Queue">
					<ItemsControl ItemsSource="{Binding PlayersService.CurrentQueue}" Background="Transparent" ItemTemplate="{StaticResource trackSmallReusableTemplate}" />
					</TabItem>
					<TabItem Header="Played">
					<ItemsControl ItemsSource="{Binding PlayersService.PlayedQueue}"  Background="Transparent" ItemTemplate="{StaticResource trackSmallReusableTemplate}" />
					</TabItem>-->
				</TabControl>
			</controls:ResponsiveColumnPanel.SecondColumn>
		</controls:ResponsiveColumnPanel>

		<!-- Small Display Mode -->
		<Grid IsVisible="{Binding IsSmallDisplay}">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>

			<Border Grid.Column="0" Margin="10" HorizontalAlignment="Center" VerticalAlignment="Top"
					BoxShadow="0 0 10 0 Black"
					MaxHeight="300"
					MaxWidth="300">
				<Border ClipToBounds="True" CornerRadius="5">
					<Panel>
						<asyncImageLoader:AdvancedImage
						Name="imgAlbumArtSmall"
						Loader="{x:Static app:App.ImageLoaderInstance}"
						Stretch="Uniform"
						MaxHeight="300"
						MaxWidth="300"
						Source="{Binding Path=PlayersService.SelectedQueue.CurrentItem.Image, Converter={StaticResource MassImageImageConverter}}" />
					</Panel>
				</Border>
			</Border>

			<!-- Track Info -->
			<StackPanel Grid.Column="1" Margin="10" Spacing="5"  VerticalAlignment="Top">
				<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Name}"  FontWeight="Bold" TextTrimming="CharacterEllipsis" />
				<TextBlock HorizontalAlignment="Center" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Artists[0].Name}" TextTrimming="CharacterEllipsis"/>

				<!-- Quality Badges for Small Display - Each as separate tag -->
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4" Margin="0,5,0,0">
					<!-- Codec Badge -->
					<Border Background="#1A1A1A"
							BorderBrush="#1DB954"
							BorderThickness="1"
							CornerRadius="3"
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatCodecConverter}}"
								   FontSize="9"
								   FontWeight="Bold"
								   Foreground="#1DB954" />
					</Border>

					<!-- Sample Rate Badge -->
					<Border Background="#1A1A1A"
							BorderBrush="#64B5F6"
							BorderThickness="1"
							CornerRadius="3"
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatSampleRateConverter}}"
								   FontSize="9"
								   FontWeight="Bold"
								   Foreground="#64B5F6" />
					</Border>

					<!-- Bit Depth Badge -->
					<Border Background="#1A1A1A"
							BorderBrush="#FFB74D"
							BorderThickness="1"
							CornerRadius="3"
							Padding="5,2"
							IsVisible="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={x:Static ObjectConverters.IsNotNull}}">
						<TextBlock Text="{Binding PlayersService.SelectedQueue.CurrentItem.StreamDetails.AudioFormat, Converter={StaticResource AudioFormatBitDepthConverter}}"
								   FontSize="9"
								   FontWeight="Bold"
								   Foreground="#FFB74D" />
					</Border>
				</StackPanel>

				<!-- Compact Progress Bar -->
				<Grid Margin="5,10,5,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Column="0" Text="{Binding PlayersService.SelectedPlayer.CurrentMedia.ElapsedTime, Converter={StaticResource FriendlyTimeConverter}}" />
					<ProgressBar Grid.Column="1" Margin="5,0"  Foreground="{Binding ColourService.ColourAccent}" Height="10" Value="{Binding PlayersService.Progress}" Minimum="0" Maximum="100" />
					<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedQueue.CurrentItem.MediaItem.Duration, Converter={StaticResource FriendlyTimeConverter}}"  />
				</Grid>


				<!-- Compact Controls -->
				<StackPanel Grid.Row="2" Margin="10" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
					<Button Classes="iconButton navButton" Command="{Binding PlayPreviousCommand}"><materialIcons:MaterialIcon Kind="SkipPrevious" Width="30" Height="30" /></Button>
					<Button Classes="iconButton navButton" Command="{Binding PlayerPlayPauseCommand}"><materialIcons:MaterialIcon Kind="PlayPause" Width="30" Height="30" /></Button>
					<Button Classes="iconButton navButton" Command="{Binding PlayerNextCommand}"><materialIcons:MaterialIcon Kind="SkipNext" Width="30" Height="30" /></Button>
				</StackPanel>


				<Grid MaxWidth="400" Margin="0,20,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Column="0" Text="0" />
					<ProgressBar Grid.Column="1" Margin="10,0,10,0"  Foreground="{Binding ColourService.ColourAccent}" Height="5" Value="{Binding PlayersService.SelectedPlayer.VolumeLevel}" Minimum="0" Maximum="100" />
					<TextBlock Grid.Column="2" Text="{Binding PlayersService.SelectedPlayer.VolumeLevel}" />
				</Grid>
			</StackPanel>
		</Grid>
	</Grid>
</UserControl>